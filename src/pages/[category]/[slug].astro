---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// 生成静态路径
export async function getStaticPaths() {
  // 从所有集合获取文章
  const civilizationRootsArticles = await getCollection('文明根基');
  const evolutionArticles = await getCollection('演进轨迹');
  const systemsArticles = await getCollection('制度与创造');
  const futureArticles = await getCollection('主体与未来');

  // 合并所有文章
  const allArticles = [
    ...civilizationRootsArticles,
    ...evolutionArticles,
    ...systemsArticles,
    ...futureArticles
  ];

  // 生成路径
  return allArticles.map(article => {
    const slug = article.id.split('/').pop()?.replace('.md', '') || '';
    const category = article.collection;
    return {
      params: { category, slug },
      props: { article }
    };
  });
}

const { article } = Astro.props;
const { Content } = await article.render();
---

<BaseLayout>
  <article class="article-page">
    <h1 class="article-title">{article.data.title}</h1>
    <div class="article-meta">
      <span class="author">作者: {article.data.author}</span>
      <span class="date">日期: {article.data.date.toLocaleDateString()}</span>
    </div>
    <Content />
  </article>
</BaseLayout>
